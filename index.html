<!-- Thrones of Honor - FULL HTML GAME (Part 1 of 2) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Thrones of Honor</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: Georgia, serif;
      background: #000;
    }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
    #entryScreen, #settingsScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: url('https://i.ibb.co/QYbWbKc/thrones-bg.jpg') no-repeat center center/cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    h1 { color: gold; text-shadow: 0 0 10px black; }
    button, input {
      padding: 12px 18px;
      font-size: 16px;
      margin: 10px;
      border-radius: 8px;
      border: none;
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 10px;
      border-radius: 10px;
      z-index: 20;
    }
    #realmMap {
      display: none;
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: url('https://i.ibb.co/ZmM35hD/kingdom-map.jpg') no-repeat center center/cover;
      z-index: 900;
    }
    .realm {
      position: absolute;
      width: 120px;
      height: 120px;
      background: rgba(0,0,0,0.5);
      color: gold;
      text-align: center;
      line-height: 120px;
      font-weight: bold;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid gold;
    }
    #missionBox {
      position: absolute;
      top: 10%; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 20px;
      width: 80vw;
      max-width: 400px;
      display: none;
      z-index: 999;
      border: 2px solid gold;
      border-radius: 15px;
    }
  </style>
</head>
<body>
  <div id="entryScreen">
    <h1>Thrones of Honor</h1>
    <button onclick="startGame()">Enter Realm</button>
    <button onclick="openSettings()">Settings</button>
  </div>

  <div id="settingsScreen" style="display:none">
    <h1>Customize Your Hero</h1>
    <input type="text" id="usernameInput" placeholder="Enter new username" />
    <button onclick="saveSettings()">Save</button>
    <button onclick="closeSettings()">Back</button>
  </div>

  <canvas id="gameCanvas"></canvas>
  <div id="hud">Loading...</div>

  <div id="realmMap">
    <div class="realm" style="top:10%;left:15%;" onclick="openMissions('North Watch')">North</div>
    <div class="realm" style="top:35%;left:50%;" onclick="openMissions('Emberfall')">Ember</div>
    <div class="realm" style="top:60%;left:20%;" onclick="openMissions('Seadrift')">Sea</div>
    <div class="realm" style="top:70%;left:70%;" onclick="openMissions('Stonehelm')">Stone</div>
  </div>

  <div id="missionBox">
    <h2 id="missionTitle">Missions</h2>
    <div id="missionList"></div>
    <button onclick="closeMissions()">Close</button>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";
import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-functions.js";

const firebaseConfig = {
  apiKey: "AIzaSyCrMnWwR3vTRSQMoid6j0d5NiO2jDdykgc",
  authDomain: "thrones-of-honor.firebaseapp.com",
  projectId: "thrones-of-honor",
  storageBucket: "thrones-of-honor.firebasestorage.app",
  messagingSenderId: "124769370805",
  appId: "1:124769370805:web:1f2c5a7102ad868cf834fc",
  measurementId: "G-YD700YJJ3Y"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth();
const functions = getFunctions(app);

let uid = null;
let playerData = {
  gold: 0,
  silver: 0,
  level: 1,
  fire: 0,
  username: "Hero",
  inventory: []
};

signInAnonymously(auth);
onAuthStateChanged(auth, async user => {
  if (user) {
    uid = user.uid;
    const ref = doc(db, "users", uid);
    const snap = await getDoc(ref);
    if (!snap.exists()) {
      await updateDoc(ref, {
        gold: 0, silver: 0, level: 1, fire: 0, inventory: [], username: "Hero"
      }).catch(() => {}); // if doc doesn't exist yet
    } else {
      playerData = { ...playerData, ...snap.data() };
    }
    updateHUD();
  }
});

function updateHUD() {
  const hud = document.getElementById("hud");
  hud.innerHTML = `üë§ ${playerData.username}<br>üèÖ Level ${playerData.level}<br>üí∞ ${playerData.gold}G | ü™ô ${playerData.silver}S<br>üî• Fire: ${playerData.fire}`;
}

function startGame() {
  document.getElementById("entryScreen").style.display = "none";
  document.getElementById("gameCanvas").focus();
}

function openSettings() {
  document.getElementById("entryScreen").style.display = "none";
  document.getElementById("settingsScreen").style.display = "flex";
  document.getElementById("usernameInput").value = playerData.username;
}

function saveSettings() {
  const newName = document.getElementById("usernameInput").value.trim();
  if (newName && uid) {
    updateDoc(doc(db, "users", uid), { username: newName });
    playerData.username = newName;
    updateHUD();
    closeSettings();
  }
}

function closeSettings() {
  document.getElementById("settingsScreen").style.display = "none";
  document.getElementById("entryScreen").style.display = "flex";
}

const missionSet = {
  "North Watch": [{ title: "Scout frozen pass", effort: 30 }, { title: "Slay ice beast", effort: 60 }],
  "Emberfall": [{ title: "Conquer lava gate", effort: 40 }, { title: "Burn enemy troops", effort: 70 }],
  "Seadrift": [{ title: "Board pirate ship", effort: 50 }, { title: "Rescue sea king", effort: 80 }],
  "Stonehelm": [{ title: "Fight stone warriors", effort: 60 }, { title: "Climb high cave", effort: 90 }]
};

function openMissions(realm) {
  const box = document.getElementById("missionBox");
  document.getElementById("missionTitle").innerText = realm + " Missions";
  const list = document.getElementById("missionList");
  list.innerHTML = "";
  missionSet[realm].forEach(m => {
    const btn = document.createElement("button");
    btn.innerText = `Do: ${m.title} (Effort ${m.effort})`;
    btn.onclick = () => completeMission(m.title, m.effort);
    list.appendChild(btn);
  });
  box.style.display = "block";
}

function closeMissions() {
  document.getElementById("missionBox").style.display = "none";
}

async function completeMission(title, effort) {
  const rewardSilver = 10;
  const rewardGold = effort >= 50 ? 13 : 0;
  playerData.silver += rewardSilver;
  playerData.gold += rewardGold;
  playerData.level += 1;
  updateHUD();
  await updateDoc(doc(db, "users", uid), {
    silver: playerData.silver,
    gold: playerData.gold,
    level: playerData.level
  });
  alert(`‚úÖ Mission Complete: ${title}\n+${rewardSilver} Silver\n+${rewardGold} Gold`);
  closeMissions();
}

// Example item purchase function
async function buyItem(itemName, costGold) {
  if (playerData.gold < costGold) return alert("Not enough gold!");
  playerData.gold -= costGold;
  playerData.inventory.push(itemName);
  await updateDoc(doc(db, "users", uid), {
    gold: playerData.gold,
    inventory: arrayUnion(itemName)
  });
  alert(`üéÅ You received ${itemName}`);
  updateHUD();
}

// Fire refill
async function buyFire(amount = 10, costUSD = 1) {
  playerData.fire += amount;
  await updateDoc(doc(db, "users", uid), { fire: playerData.fire });
  updateHUD();
  alert(`üî• Purchased ${amount} fire!`);
}

window.startGame = startGame;
window.openSettings = openSettings;
window.saveSettings = saveSettings;
window.closeSettings = closeSettings;
window.openMissions = openMissions;
window.closeMissions = closeMissions;
window.completeMission = completeMission;
window.buyItem = buyItem;
window.buyFire = buyFire;
</script>

</body>
</html>
