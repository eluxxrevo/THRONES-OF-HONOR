<!DOCTYPE html><html>
<head>
  <meta charset="UTF-8">
  <title>Thrones of Honor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    html, body { margin: 0; background: #000; color: gold; font-family: Georgia, serif; overflow: hidden; }
    #hud { position: absolute; top: 0; left: 0; width: 100%; background: rgba(0,0,0,0.8); padding: 10px; font-size: 16px; text-align: center; z-index: 2; }
    canvas { display: block; width: 100vw; height: 100vh; background: #111; }
    #menu, #battleBox { position: absolute; bottom: 10px; left: 10px; z-index: 3; }
    button { background: gold; border: none; padding: 8px 12px; margin: 5px; border-radius: 5px; font-weight: bold; }
    #battleBox { display: none; background: #111; color: gold; padding: 15px; border: 2px solid gold; top: 20%; width: 90%; }
  </style>
</head>
<body><div id="hud">Loading player...</div>
<canvas id="gameCanvas" width="800" height="400"></canvas><div id="menu">
  <button onclick="doMission()">🔥 Mission</button>
  <button onclick="buyFire()">🔥+10 Fire (10g)</button>
  <button onclick="startBattle()">⚔️ Battle</button>
  <button onclick="openMap()">🌍 Map</button>
  <button onclick="openShop()">🛒 Shop</button>
  <button onclick="customizeUser()">👤 Settings</button>
  <button onclick="dragonFlight()">🐉 Fly Dragon</button>
</div><div id="battleBox">
  <h3>⚔️ Battle Arena</h3>
  <p id="enemyText">A wild beast appears!</p>
  <p id="battleLog"></p>
  <button onclick="chooseBattle('attack')">🗡 Attack</button>
  <button onclick="chooseBattle('defend')">🛡 Defend</button>
  <button onclick="chooseBattle('item')">🎒 Use Fire</button><br><br>
  <button onclick="endBattle()">❌ Flee</button>
</div><script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCrMnWwR3vTRSQMoid6j0d5NiO2jDdykgc",
  authDomain: "thrones-of-honor.firebaseapp.com",
  projectId: "thrones-of-honor",
  storageBucket: "thrones-of-honor.firebasestorage.app",
  messagingSenderId: "124769370805",
  appId: "1:124769370805:web:1f2c5a7102ad868cf834fc"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth();
let uid = null;
let player = { username: "Hero", gold: 20, fire: 0, level: 1, skin: "Warrior", inventory: [] };

signInAnonymously(auth);
onAuthStateChanged(auth, async (user) => {
  if (user) {
    uid = user.uid;
    const ref = doc(db, "users", uid);
    const snap = await getDoc(ref);
    if (snap.exists()) player = snap.data();
    else await setDoc(ref, player);
    updateHUD();
  }
});

function updateHUD() {
  document.getElementById("hud").innerText = `👤 ${player.username} [${player.skin || 'No Skin'}] | Lv.${player.level} | 💰 ${player.gold}G | 🔥 ${player.fire}`;
}

async function doMission() {
  player.gold += 10; player.level += 1;
  await updateDoc(doc(db, "users", uid), { gold: player.gold, level: player.level });
  updateHUD(); alert("✅ Mission Complete! +10g, +1 level");
}

async function buyFire() {
  if (player.gold < 10) return alert("❌ Not enough gold!");
  player.gold -= 10; player.fire += 10;
  await updateDoc(doc(db, "users", uid), { gold: player.gold, fire: player.fire });
  updateHUD();
}

function openShop() {
  const item = prompt("Shop: Horse=50g, Boat=70g, Sword=30g, Shield=25g");
  let price = { horse:50, boat:70, sword:30, shield:25 }[item.toLowerCase()];
  if (!price) return alert("Invalid item");
  if (player.gold < price) return alert("Not enough gold");
  player.gold -= price;
  player.inventory.push(item);
  updateDoc(doc(db, "users", uid), { gold: player.gold, inventory: arrayUnion(item) });
  updateHUD(); alert(`✅ Purchased ${item}`);
}

function startBattle() {
  alert("⚔️ Enemy encountered! Use attack or fire to defeat them.");
  document.getElementById('battleBox').style.display = 'block';
}
function chooseBattle(action) {
  if (action === 'item' && player.fire > 0) {
    player.fire--;
    updateDoc(doc(db, "users", uid), { fire: player.fire });
    updateHUD(); alert("🔥 Fire used! Enemy defeated.");
  } else if (action === 'attack') {
    alert("🗡 You attack with sword!");
  } else {
    alert("🛡 You defend.");
  }
}
function endBattle() {
  document.getElementById('battleBox').style.display = 'none';
}

const kingdoms = [
  { name: "Winterfell", color: "#2a2f4a", event: "💀 Frozen ambush!" },
  { name: "Essos", color: "#4a2a2a", event: "🏜 Sand bandits attack!" },
  { name: "King's Landing", color: "#4a4a2a", event: "🔥 Fire riots in the street!" },
  { name: "Dragonstone", color: "#2a4a2f", event: "🐉 Dragon egg found!" }
];
let currentKingdom = 0;
function openMap() {
  currentKingdom = (currentKingdom + 1) % kingdoms.length;
  document.body.style.background = kingdoms[currentKingdom].color;
  alert(`🗺 Traveled to ${kingdoms[currentKingdom].name}\nEvent: ${kingdoms[currentKingdom].event}`);
}

function customizeUser() {
  const name = prompt("Enter new username:", player.username);
  if (name) player.username = name;
  const skin = prompt("Choose skin: Warrior, Hunter, Rogue, Royal", player.skin);
  if (["Warrior", "Hunter", "Rogue", "Royal"].includes(skin)) player.skin = skin;
  updateDoc(doc(db, "users", uid), { username: player.username, skin: player.skin });
  updateHUD(); alert(`✅ Updated to ${player.username} as ${player.skin}`);
}

function dragonFlight() {
  if (!player.inventory.includes("dragon")) return alert("🐉 You must own a dragon to fly!");
  if (player.fire < 1) return alert("🔥 Not enough fire to fly.");
  player.fire--;
  updateDoc(doc(db, "users", uid), { fire: player.fire });
  updateHUD(); alert("🐉 You soar across the skies to the next kingdom!");
  openMap();
}
</script></body>
</html>
